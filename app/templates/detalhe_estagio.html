{% extends 'base.html' %}

{% block content %}
<style>
    .mermaid-container {
        width: 100%;
        max-width: 700px;
        min-height: 350px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: rgba(17, 24, 39, 0.3);
        border-radius: 1rem;
        border: 1px solid rgba(75, 85, 99, 0.3);
        padding: 1.5rem;
    }

    .mermaid {
        width: 100% !important;
        visibility: visible !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        height: auto !important;
    }

    /* Estilo para o botão de copiar flutuante */
    .copy-btn {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .group:hover .copy-btn {
        opacity: 1;
    }
</style>

<div class="max-w-4xl mx-auto mb-20">
    <a href="/" class="text-blue-500 hover:text-blue-400 mb-6 inline-flex items-center font-semibold transition-colors">
        <i class="fas fa-arrow-left mr-2"></i> Voltar ao Dashboard
    </a>
    
    <div class="bg-gray-800 border border-gray-700 rounded-2xl p-8 shadow-2xl">
        
        <div class="flex items-center space-x-4 mb-8">
            <div class="w-16 h-16 bg-{{ item.cor }}-600/20 rounded-2xl flex items-center justify-center">
                <i class="fas {{ item.icone }} text-3xl text-{{ item.cor }}-500"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-white">{{ item.titulo }}</h1>
                <p class="text-gray-400">{{ item.subtitulo }}</p>
            </div>
        </div>

        <div class="prose prose-invert max-w-none">
            
            <p class="text-lg text-gray-300 leading-relaxed mb-8">
                {{ item.explicacao }}
            </p>

            <div class="my-10">
                {% if item.id == 1 %}
                <h4 class="text-center text-xs text-gray-500 uppercase mb-4 tracking-widest">Fluxo: PC <-> Nuvem</h4>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph LR
                        A[Seu Computador] -- git clone --> B(GitHub)
                        B -- git pull --> A
                        A -- git push --> B
                        style B fill:#1e40af,stroke:#3b82f6,stroke-width:2px
                    </div>
                </div>

                {% elif item.id == 2 %}
                <h4 class="text-center text-xs text-gray-500 uppercase mb-4 tracking-widest">Árvore de Trabalho</h4>
                <div class="mermaid-container">
                    <div class="mermaid">
                        gitGraph
                          commit id: "Initial"
                          branch feature/nova-tela
                          checkout feature/nova-tela
                          commit id: "Code"
                          commit id: "Test"
                          checkout main
                          merge feature/nova-tela
                    </div>
                </div>

                {% elif item.id == 3 %}
                <h4 class="text-center text-xs text-gray-500 uppercase mb-4 tracking-widest">O Ciclo de Revisão</h4>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph LR
                        A[Sua Branch] -- "Abrir PR" --> B{Revisão do Time}
                        B -- "Ajustes" --> A
                        B -- "Aprovar" --> C[Merge Develop]
                        style B fill:#7e3af2,stroke:#fff,color:#fff
                    </div>
                </div>

                {% elif item.id == 4 %}
                <h4 class="text-center text-xs text-gray-500 uppercase mb-4 tracking-widest">Conflito de Código</h4>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph TD
                        A[Versão Colega] --> C[Mesma Linha]
                        B[Sua Versão] --> C
                        C --> D{CONFLITO!}
                        D -- "Decisão Humana" --> E[Código Unificado]
                        style D fill:#e02424,stroke:#fff,color:#fff
                    </div>
                </div>

                {% elif item.id == 5 %}
                <h4 class="text-center text-xs text-gray-500 uppercase mb-4 tracking-widest">Pipeline CI/CD</h4>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph LR
                        A[Código] -- push --> B(GitHub)
                        subgraph CI
                        B --> C{Testes}
                        C -- Passou --> D[Build]
                        end
                        D -- Deploy --> E[Externo]
                        style E fill:#34a853,stroke:#fff,color:#fff
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="relative group">
                <h3 class="text-xl font-bold mb-4 text-white flex items-center mt-10">
                    <i class="fas fa-terminal mr-2 text-green-500 text-sm"></i> No seu terminal:
                </h3>
                
                <button onclick="copyToClipboard('terminal-content')" class="copy-btn absolute right-2 top-12 bg-gray-700 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-xs font-sans flex items-center shadow-lg transition-all">
                    <i class="far fa-copy mr-2"></i> Copiar
                </button>

                <div id="terminal-content" class="bg-black rounded-lg p-5 font-mono text-sm text-green-400 mb-8 border border-gray-700 shadow-inner">
                    {% for cmd in item.comandos %}
                    <p class="mb-2"><span class="text-gray-500 select-none">$</span> {{ cmd }}</p>
                    {% endfor %}
                </div>
            </div>

            <div class="bg-{{ item.cor }}-900/20 border-l-4 border-{{ item.cor }}-500 p-6 rounded-r-lg mt-10">
                <div class="flex items-center mb-2 text-{{ item.cor }}-400 uppercase text-xs font-black tracking-widest">
                    <i class="fas fa-user-tie mr-2"></i> Papo de Sênior
                </div>
                <p class="text-gray-300 italic text-lg font-serif">
                    "{{ item.dica_senior }}"
                </p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
    // Inicialização do Mermaid
    mermaid.initialize({
        startOnLoad: true,
        theme: 'dark',
        securityLevel: 'loose',
        fontFamily: 'Inter, sans-serif'
    });

    // Função para Copiar Comandos do Terminal
    function copyToClipboard(elementId) {
        const text = document.getElementById(elementId).innerText.replace(/\$/g, '').trim();
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector('.copy-btn');
            const originalHTML = btn.innerHTML;
            
            // Feedback visual de sucesso
            btn.innerHTML = '<i class="fas fa-check text-green-500 mr-2"></i> Copiado!';
            btn.classList.add('bg-gray-600');
            
            setTimeout(() => { 
                btn.innerHTML = originalHTML;
                btn.classList.remove('bg-gray-600');
            }, 2000);
        }).catch(err => {
            console.error('Erro ao copiar: ', err);
        });
    }
</script>
{% endblock %}